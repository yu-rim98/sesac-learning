# OAuth 2.0 개념과 소셜 로그인 구현 과정 정리 (feat. Kakao)

개발을 하다 보면 "그냥 구글로 로그인하기 없어요?"라는 말을 듣게 된다. 사용자 입장에서는 너무나 편리하지만, 구현하는 개발자 입장에서는 흐름을 정확히 이해해야 하는 기술, 바로 **OAuth 2.0**이다. 이번 프로젝트에서 소셜 로그인을 구현하며 공부한 내용을 정리해 본다.

## 1. OAuth 2.0이란?
많은 사람들이 오해하지만, OAuth는 엄밀히 말해 **인증(Authentication) 프로토콜이 아니라 인가(Authorization)를 위한 개방형 표준**이다.

쉽게 말해 **"내 서비스(Client)가 사용자를 대신해 구글이나 카카오 같은 외부 서비스의 데이터(프로필 등)에 접근할 수 있도록 허락(권한)을 받는 기술"** 이라고 이해하면 된다. 우리는 이 권한을 통해 얻은 사용자 정보를 바탕으로 우리 서비스의 '로그인(인증)' 처리를 수행하는 것이다.

### 왜 쓸까?
* **보안:** 사용자가 우리 서비스에 구글/카카오 비밀번호를 넘겨줄 필요가 없다.
* **편의성:** 복잡한 회원가입 절차 없이 클릭 몇 번으로 진입 가능하다.

---

## 2. 핵심 용어 정리
OAuth 문서를 보면 낯선 용어들이 등장하는데, 아래 4가지는 필수적으로 알아야 한다.



1.  **Resource Owner (사용자):** 로그인을 하려는 실제 사람. 데이터의 주인이다.
2.  **Client (우리 서비스):** 사용자를 대신해 데이터에 접근하려는 웹이나 앱.
3.  **Authorization Server (인증 서버):** ID/PW를 확인하고 '인가 코드'나 '토큰'을 발급해 주는 서버 (ex. 카카오 로그인 서버).
4.  **Resource Server (자원 서버):** 실제 사용자 정보(이름, 이메일 등)를 가지고 있는 서버 (ex. 카카오 API 서버).

---

## 3. 소셜 로그인 동작 흐름 (Authorization Code 방식)
가장 많이 쓰이고 보안성이 높은 **인가 코드 승인 방식(Authorization Code Grant)** 의 흐름을 정리했다.

> **핵심 흐름:** 요청 ➔ 사용자 동의 ➔ 인가 코드(Code) 받기 ➔ 액세스 토큰(Token) 교환 ➔ 사용자 정보 획득 ➔ 로그인 완료



### Step 1. 로그인 요청
사용자가 앱에서 '카카오로 로그인' 버튼을 클릭한다. 이때 프론트엔드는 사용자를 카카오 로그인 페이지로 **Redirect** 시킨다.
* 이때 `client_id`(식별자)와 `redirect_uri`(돌아올 주소)를 쿼리 파라미터로 함께 보낸다.

### Step 2. 사용자 인증 및 동의
사용자는 카카오 화면에서 ID/PW를 입력하고, 우리 앱이 정보를 사용하는 것에 대해 **'동의'** 버튼을 누른다.

### Step 3. Authorization Code (인가 코드) 발급
로그인과 동의가 완료되면, 카카오는 사전에 설정된 `redirect_uri`로 사용자를 이동시킨다. 이때 URL 뒤에 **인가 코드(Code)** 가 붙어온다.
* 예시: `https://myapp.com/callback?code=임시코드1234`

### Step 4. Access Token 교환 (Backend 처리)
여기서부터가 중요하다. 프론트엔드가 받은 `Code`를 우리 백엔드 API로 전달한다.
백엔드는 받은 `Code`와 `Client Secret`(보안키)를 담아 카카오 인증 서버에 직접 요청을 보낸다.

### Step 5. Token 발급
카카오 서버는 코드가 유효한지 확인하고, 유효하다면 실제 정보에 접근할 수 있는 **Access Token**을 발급해 준다.

### Step 6. 사용자 정보 요청 및 로그인 처리
1.  백엔드는 발급받은 `Access Token`을 헤더에 담아 카카오 API 서버에 사용자 정보(이메일, 닉네임 등)를 요청한다.
2.  응답받은 정보를 바탕으로 우리 DB를 조회 및 저장한다.
3.  마지막으로 우리 서비스 전용 **JWT(Access/Refresh Token)** 를 생성하여 프론트엔드에 반환한다.

---

## 4. 구현 로직 핵심 요약 (Spring Boot 관점)

소셜 로그인은 단순히 외부 API를 부르는 것에서 끝나지 않고, 우리 서비스의 회원 정보와 동기화하는 과정이 필요하다. 구현하며 정리한 로직은 다음과 같다.

### 1) 정보 획득
카카오에서 `Access Token` 검증 후 사용자 정보(ID, 닉네임, 프로필 사진 등)를 응답받는다.

### 2) 가입 여부 확인 & 로직 분기
가져온 정보 중 고유 ID(Provider ID)를 사용해 DB를 조회한다.
* **신규 회원:** DB에 해당 정보가 없으면 `User` 객체를 생성(`createKakaoUser`)하고 `save`하여 회원가입 처리한다.
* **기존 회원:** 이미 가입된 회원이면 해당 `User` 객체를 가져온다.

### 3) 정보 동기화 (Update)
기존 회원이라도 프로필 사진이나 닉네임이 변경되었을 수 있다. `updateOAuthProfile` 같은 메서드를 실행해 최신 상태로 동기화한다. (이 부분은 서비스 정책에 따라 다를 수 있다.)

### 4) 자체 토큰 발급 (JWT)
모든 처리가 끝나면, 클라이언트가 우리 서버 API를 사용할 수 있도록 **자체 JWT**를 발급해 반환한다. 이제 클라이언트는 카카오 토큰이 아닌, 이 JWT를 사용해 통신하게 된다.

## 5. 정리
OAuth 2.0은 처음 접하면 복잡해 보이지만, **"코드를 받고 ➔ 토큰으로 바꾸고 ➔ 정보를 가져온다"** 는 큰 흐름만 이해하면 구현이 훨씬 수월해진다. 특히 보안을 위해 `Client Secret`이나 `Access Token` 관리는 프론트엔드가 아닌 **백엔드에서 처리**하는 것이 안전하다는 점을 꼭 기억하자.