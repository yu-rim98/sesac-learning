<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<head>
  <title>프로필 편집</title>
</head>
<body>
<div layout:fragment="content">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">프로필 편집</h5>
        </div>
        <div class="card-body">
          <form th:action="@{/profile/edit}" th:object="${profileUpdateRequest}" method="post">

            <!-- 서버 에러 메시지 -->
            <div th:if="${#fields.hasGlobalErrors()}" class="alert alert-danger">
              <span th:each="err : ${#fields.globalErrors()}" th:text="${err}"></span>
            </div>

            <!-- 프로필 이미지 (미리보기) -->
            <div class="text-center mb-4">
              <img th:src="${currentUser.profileImageUrl != null ? currentUser.profileImageUrl : '/images/default-profile.png'}"
                   class="rounded-circle img-thumbnail"
                   width="100" height="100"
                   alt="프로필 이미지">
              <p class="text-muted small mt-2">프로필 사진 변경은 Day 10에서 구현합니다</p>
            </div>

            <!-- Username (읽기 전용) -->
            <div class="mb-3">
              <label class="form-label">사용자 이름</label>
              <input type="text" class="form-control"
                     th:value="${currentUser.username}" disabled>
              <div class="form-text">사용자 이름은 변경할 수 없습니다.</div>
            </div>

            <!-- Email (읽기 전용) -->
            <div class="mb-3">
              <label class="form-label">이메일</label>
              <input type="text" class="form-control"
                     th:value="${currentUser.email}" disabled>
              <div class="form-text">이메일은 변경할 수 없습니다.</div>
            </div>

            <!-- Name -->
            <div class="mb-3">
              <label for="name" class="form-label">이름</label>
              <input type="text" id="name" th:field="*{name}" class="form-control"
                     th:classappend="${#fields.hasErrors('name')} ? 'is-invalid'"
                     placeholder="이름을 입력하세요">
              <div class="invalid-feedback" th:if="${#fields.hasErrors('name')}"
                   th:errors="*{name}"></div>
            </div>

            <!-- Bio -->
            <div class="mb-3">
              <label for="bio" class="form-label">자기소개</label>
              <textarea id="bio" th:field="*{bio}" class="form-control" rows="3"
                        th:classappend="${#fields.hasErrors('bio')} ? 'is-invalid'"
                        placeholder="자기소개를 입력하세요"></textarea>
              <div class="invalid-feedback" th:if="${#fields.hasErrors('bio')}"
                   th:errors="*{bio}"></div>
              <div class="form-text">최대 150자까지 입력 가능합니다.</div>
            </div>

            <!-- 버튼 -->
            <div class="d-flex justify-content-between">
              <a th:href="@{'/users/' + ${currentUser.username}}"
                 class="btn btn-outline-secondary">취소</a>
              <button type="submit" class="btn btn-primary">저장</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>