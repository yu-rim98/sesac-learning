# JavaScript 비동기 처리와 이벤트 루프

> 자바스크립트는 한번에 하나의 작업만 처리할 수 있는 **싱글 스레드(Single Thread)** 언어이다.  
> 하지만 `setTimeout`이나 서버 통신과 같은 시간이 걸리는 작업을 **기다리지 않고 바로 다음 코드를 실행**하여 **동시에 여러 작업이 처리**되는 것처럼 보이게 한다.
> 위와 같은 처리가 가능한 이유는 자바스크립트 엔진뿐만 아니라 브라우저 환경이 제공하는 여러 요소들이 함께 동작하기 때문이다.

## 비동기 처리의 핵심 구성 요소
### 1. 호출 스택(Call Stack) - (LIFO)
> 자바스크립트 코드가 실행될 때 작업이 순서대로 쌓이는 공간이다.   
> 한번에 하나의 작업만 처리할 수 있으며 가장 위에 있는 작업이 현재 실행 중인 작업이다.

### 2. Web API(브라우저 API)
> `setTimeout`, `fetch(서버 통신)`, `DOM 이벤트` 등 시간이 걸리는 비동기 작업을 처리하는 별도의 공간으로 자바스크립트 엔진이 아니라 브라우저가 제공한다.

### 3. 콜백 큐(Callback Queue / Task Queue)
> Web API에서 처리 완료된 비동기 작업의 **콜백 함수**가 실행 순서를 기다리는 대기열이다.

### 4. 이벤트 루프(Event Loop)
> **호출 스택**과 **콜백 큐**를 지속적으로 감시하는 역할을 한다.

## 비동기 작업의 처리과정 (`setTimeout` 예시)
1. `setTimeout(callback, 2000)` 코드가 호출 스택에 들어온다.
2. 자바스크립트 엔진은 해당 작업이 비동기 작업임을 인지하고, 처리를 브라우저의 **Web API**에게 위임한 뒤 바로 스택에서 제거한다. (덕분에 다음 코드가 바로 실행될 수 있음 -> **논블로킹**)
3. **WebAPI**는 2초의 타이머를 작동시키고, 해당 시간동안 자바스크립트 엔진은 다른 동기 코드들을 계속 처리한다.
4. 2초가 지나면, **WebAPI**는 타이머 작업이 끝났음을 확인하고 준비된 `callback` 함수를 **콜백 큐**로 보낸다.
5. **이벤트 루프**는 **호출 스택이 완전히 비어 있는 것**을 확인한 뒤, **콜백 큐**에 대기 중인 `callback` 함수를 **호출 스택**으로 이동시킨다.
6. **호출 스택**으로 옮겨진 `callback` 함수가 실행된다.